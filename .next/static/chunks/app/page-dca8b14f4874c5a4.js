(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1226:()=>{},7134:(e,s,l)=>{Promise.resolve().then(l.bind(l,4467))},4467:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>k});var a=l(5155),t=l(8162),c=l(2115);l(7595);var r=l(9257),n=l(6822);let i=()=>(0,a.jsx)("div",{className:"w-full flex flex-1 flex-col items-center justify-center p-16 bg-base-100/50",children:(0,a.jsxs)("div",{className:"max-w-md text-center space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-center gap-4 mb-4",children:(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-primary/10 flex items-center   justify-center animate-bounce",children:(0,a.jsx)(n.A,{className:"w-8 h-8 text-primary "})})})}),(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Welcome to Chatty!"}),(0,a.jsx)("p",{className:"text-base-content/60",children:"Select a conversation from the sidebar to start chatting"})]})});var d=l(4057);let o=(0,d.A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),u=()=>{let{selectedUser:e,setSelectedUser:s}=(0,c.useContext)(r.U),{onlineUsers:l}=(0,c.useContext)(t.F);return(0,a.jsx)("div",{className:"p-2.5 border-b border-base-300",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"avatar",children:(0,a.jsx)("div",{className:"size-10 rounded-full relative",children:(0,a.jsx)("img",{src:e.profilePic||"/avatar.png",alt:e.fullName})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:e.fullName}),(0,a.jsx)("p",{className:"text-sm text-base-content/70",children:l.includes(e._id)?"Online":"Offline"})]})]}),(0,a.jsx)("button",{onClick:()=>s(null),children:(0,a.jsx)(o,{})})]})})},x=(0,d.A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var m=l(9609),h=l(5037);let f=()=>{let[e,s]=(0,c.useState)(""),[l,t]=(0,c.useState)(null),n=(0,c.useRef)(null),{sendMessage:i,selectedUser:d}=(0,c.useContext)(r.U),u=async a=>{if(a.preventDefault(),e.trim()||l)try{await i({text:e.trim(),image:l}),s(""),t(null),n.current&&(n.current.value="")}catch(e){console.error("Failed to send message:",e)}};return(0,a.jsxs)("div",{className:"p-4 w-full",children:[l&&(0,a.jsx)("div",{className:"mb-3 flex items-center gap-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:l,alt:"Preview",className:"w-20 h-20 object-cover rounded-lg border border-zinc-700"}),(0,a.jsx)("button",{onClick:()=>{t(null),n.current&&(n.current.value="")},className:"absolute -top-1.5 -right-1.5 w-5 h-5 rounded-full bg-base-300   flex items-center justify-center",type:"button",children:(0,a.jsx)(o,{className:"size-3"})})]})}),(0,a.jsxs)("form",{onSubmit:u,className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 flex gap-2",children:[(0,a.jsx)("input",{type:"text",className:"w-full input input-bordered rounded-lg input-sm sm:input-md",placeholder:"Type a message...",value:e,onChange:e=>s(e.target.value)}),(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",ref:n,onChange:e=>{let s=e.target.files[0];if(!s.type.startsWith("image/")){h.Ay.error("Please select an image file");return}let l=new FileReader;l.onloadend=()=>{t(l.result)},l.readAsDataURL(s)}}),(0,a.jsx)("button",{type:"button",className:"hidden sm:flex btn btn-circle\n                     ".concat(l?"text-emerald-500":"text-zinc-400"),onClick:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.click()},children:(0,a.jsx)(x,{size:20})})]}),(0,a.jsx)("button",{type:"submit",className:"btn btn-sm btn-circle",disabled:!e.trim()&&!l,children:(0,a.jsx)(m.A,{size:22})})]})]})},v=()=>{let e=Array(6).fill(null);return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:e.map((e,s)=>(0,a.jsxs)("div",{className:"chat ".concat(s%2==0?"chat-start":"chat-end"),children:[(0,a.jsx)("div",{className:"chat-image avatar",children:(0,a.jsx)("div",{className:"size-10 rounded-full",children:(0,a.jsx)("div",{className:"skeleton w-full h-full rounded-full"})})}),(0,a.jsx)("div",{className:"chat-header mb-1",children:(0,a.jsx)("div",{className:"skeleton h-4 w-16"})}),(0,a.jsx)("div",{className:"chat-bubble bg-transparent p-0",children:(0,a.jsx)("div",{className:"skeleton h-16 w-[200px]"})})]},s))})},g=()=>{let{messages:e,getMessages:s,isMessagesLoading:l,selectedUser:n,subscribeToMessages:i,unsubscribeToMessages:d}=(0,c.useContext)(r.U),{authUser:o}=(0,c.useContext)(t.F),x=(0,c.useRef)();return((0,c.useEffect)(()=>(s(n._id),i(),()=>d()),[n._id,s,i,d]),(0,c.useEffect)(()=>{x.current&&e&&x.current.scrollIntoView({behavior:"smooth"})},[e]),l)?(0,a.jsxs)("div",{className:"flex flex-1 flex-col overflow-auto",children:[(0,a.jsx)(u,{}),(0,a.jsx)(v,{}),(0,a.jsx)(f,{})]}):(0,a.jsxs)("div",{className:"flex flex-1 flex-col overflow-auto ",children:[(0,a.jsx)(u,{}),(0,a.jsx)("div",{className:"flex-row flex-1 overflow-y-auto space-y-4",children:e.map(e=>(0,a.jsxs)("div",{ref:x,className:"chat ".concat(e.senderId===o._id?"chat-end":"chat-start"),children:[(0,a.jsx)("div",{className:"chat-image avatar",children:(0,a.jsx)("div",{className:"size-10 rounded-full border",children:(0,a.jsx)("img",{src:e.senderId===o._id?o.profilePic||"/avatar.png":n.profilePic||"/avatar.png",alt:""})})}),(0,a.jsx)("div",{className:"chat-header mb-1",children:(0,a.jsx)("time",{className:"text-xs opacity-50 ml-1",children:new Date(e.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})}),(0,a.jsxs)("div",{className:"chat-bubble flex-col",children:[e.image&&(0,a.jsx)("img",{src:e.image,alt:"Attachment",className:"sm:max-w-[200px] rounded-md mb-2"}),e.text&&(0,a.jsx)("p",{children:e.text})]})]},e._id))}),(0,a.jsx)(f,{})]})},j=(0,d.A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),p=()=>{let e=Array(8).fill(null);return(0,a.jsxs)("aside",{className:"h-full w-20 lg:w-72 border-r border-base-300    flex flex-col transition-all duration-200",children:[(0,a.jsx)("div",{className:"border-b border-base-300 w-full p-5",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j,{className:"w-6 h-6"}),(0,a.jsx)("span",{className:"font-medium hidden lg:block",children:"Contacts"})]})}),(0,a.jsx)("div",{className:"overflow-y-auto w-full py-3",children:e.map((e,s)=>(0,a.jsxs)("div",{className:"w-full p-3 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"relative mx-auto lg:mx-0",children:(0,a.jsx)("div",{className:"skeleton size-12 rounded-full"})}),(0,a.jsxs)("div",{className:"hidden lg:block text-left min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"skeleton h-4 w-32 mb-2"}),(0,a.jsx)("div",{className:"skeleton h-3 w-16"})]})]},s))})]})},b=()=>{let{getUsers:e,users:s,selectedUser:l,setSelectedUser:n,isUsersLoading:i}=(0,c.useContext)(r.U),{onlineUsers:d,connectSocket:o}=(0,c.useContext)(t.F),[u,x]=(0,c.useState)(!1);(0,c.useEffect)(()=>{e(),o()},[e]);let m=u?s.filter(e=>d.includes(e._id)):s;return i?(0,a.jsx)(p,{}):(0,a.jsxs)("aside",{className:"h-full w-20 lg:w-72 border-r border-base-300 flex flex-col transition-all duration-200",children:[(0,a.jsxs)("div",{className:"border-b border-base-300 w-full p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j,{className:"size-6"}),(0,a.jsx)("span",{className:"font-medium hidden lg:block",children:"Contacts"})]}),(0,a.jsxs)("div",{className:"mt-3 hidden lg:flex items-center gap-2",children:[(0,a.jsxs)("label",{className:"cursor-pointer flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:u,onChange:e=>x(e.target.checked),className:"checkbox checkbox-sm"}),(0,a.jsx)("span",{className:"text-sm",children:"Show online only"})]}),(0,a.jsxs)("span",{className:"text-xs text-zinc-500",children:["(",d.length-1," online)"]})]})]}),(0,a.jsxs)("div",{className:"overflow-y-auto w-full py-3",children:[m.map(e=>(0,a.jsxs)("button",{onClick:()=>n(e),className:"\n              w-full p-3 flex items-center gap-3\n              hover:bg-base-300 transition-colors\n              ".concat((null==l?void 0:l._id)===e._id?"bg-base-300 ring-1 ring-base-300":"","\n            "),children:[(0,a.jsxs)("div",{className:"relative mx-auto lg:mx-0",children:[(0,a.jsx)("img",{src:e.profilePic||"/avatar.png",alt:e.name,className:"size-12 object-cover rounded-full"}),d.includes(e._id)&&(0,a.jsx)("span",{className:"absolute bottom-0 right-0 size-3 bg-green-500    rounded-full ring-2 ring-zinc-900"})]}),(0,a.jsxs)("div",{className:"hidden lg:block text-left min-w-0",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.fullName}),(0,a.jsx)("div",{className:"text-sm text-zinc-400",children:d.includes(e._id)?"Online":"Offline"})]})]},e._id)),0===m.length&&(0,a.jsx)("div",{className:"text-center text-zinc-500 py-4",children:"No online users"})]})]})},y=()=>{let{selectedUser:e}=(0,c.useContext)(r.U);return(0,a.jsx)("div",{className:"h-screen bg-base-200",children:(0,a.jsx)("div",{className:"flex items-enter justify-center pt-20 px-4",children:(0,a.jsx)("div",{className:"bg-base-200 rounder-lg shadow-cl w-full max-w-6xl h-[calc(100vh-8rem)]",children:(0,a.jsxs)("div",{className:"flex h-full rounder-lg overflow-hidden",children:[(0,a.jsx)(b,{}),e?(0,a.jsx)(g,{}):(0,a.jsx)(i,{})]})})})})};var N=l(6046),w=l(9766);function k(){let{authUser:e,checkAuth:s,onlineUsers:l,connectSocket:r}=(0,c.useContext)(t.F),{theme:n}=(0,c.useContext)(w.D);return(0,c.useEffect)(()=>{s(),r()},[s]),e||(0,N.redirect)("/login"),(0,a.jsx)("div",{children:(0,a.jsx)(y,{})})}},9257:(e,s,l)=>{"use strict";l.d(s,{U:()=>i,default:()=>d});var a=l(5155),t=l(2115),c=l(5037),r=l(7595),n=l(8162);let i=(0,t.createContext)(),d=e=>{let{children:s}=e,{socket:l}=(0,t.useContext)(n.F),[d,o]=(0,t.useState)(),[u,x]=(0,t.useState)([]),[m,h]=(0,t.useState)([]),[f,v]=(0,t.useState)(null),[g,j]=(0,t.useState)(!1),[p,b]=(0,t.useState)(!1);console.log(l);let y=(0,t.useCallback)(async()=>{j(!0);try{let e=await r.S.get("/messages/users");h(e.data)}catch(l){var e,s;c.Ay.error((null==l?void 0:null===(s=l.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Failed to fetch users")}finally{j(!1)}},[]),N=(0,t.useCallback)(async e=>{b(!0);try{let s=await r.S.get("/messages/".concat(e));x(s.data)}catch(e){var s,l;c.Ay.error(null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.message)}finally{b(!1)}},[]),w=(0,t.useCallback)(async e=>{console.log(f);try{let s=await r.S.post("/messages/send/".concat(f._id),e);x(e=>[...e,s.data])}catch(e){c.Ay.error("Failed to send message")}},[f]),k=(0,t.useCallback)(()=>{if(!l||!f){console.error("no socket found");return}null==l||l.on("newMessage",e=>{e.senderId!==f._id&&console.log("received msg:",e),x(s=>[...s,e])})},[l,f]),S=(0,t.useCallback)(()=>{null==l||l.off("newMessage")},[l,f]);return(0,a.jsx)(i.Provider,{value:{chat:d,setChat:o,messages:u,setMessages:x,users:m,setUsers:h,selectedUser:f,setSelectedUser:v,isUsersLoading:g,setIsUsersLoading:j,isMessagesLoading:p,setIsMessagesLoading:b,getMessages:N,getUsers:y,sendMessage:w,subscribeToMessages:k,unsubscribeToMessages:S},children:s})}},8162:(e,s,l)=>{"use strict";l.d(s,{F:()=>i,default:()=>d});var a=l(5155),t=l(7595);l(6046),l(5521);var c=l(2115),r=l(5037),n=l(1319);let i=(0,c.createContext)(),d=e=>{let{children:s}=e,[l,d]=(0,c.useState)(null),[o,u]=(0,c.useState)(!1),[x,m]=(0,c.useState)(!1),[h,f]=(0,c.useState)(!1),[v,g]=(0,c.useState)(!0),[j,p]=(0,c.useState)([]),[b,y]=(0,c.useState)(null),N=(0,c.useCallback)(async()=>{if(!(null==l?void 0:l._id)){console.error("No authUser or userId found");return}console.log("Connecting socket for user:",l._id);let e=(0,n.io)("http://localhost:5001",{query:{userId:l._id}});return e.on("connect",()=>{console.log("Socket connected:",e.id)}),e.on("connect_error",e=>{console.error("Socket connection error:",e)}),e.on("getOnlineUsers",e=>{console.log("Online users:",e),p(e)}),console.log(e),y(e),()=>{e.disconnect()}},[l]),w=async()=>{(null==b?void 0:b.connected)&&b.disconnect()},k=(0,c.useCallback)(async()=>{try{let e=await t.S.get("/auth/check");d(e.data)}catch(e){console.error("Auth check failed:",e),d(null)}finally{g(!1)}},[]),S=async e=>{u(!0);try{let s=await t.S.post("/auth/signup",e);d(s.data),console.log(s.data),r.Ay.success("Account created successfully!"),N()}catch(e){r.Ay.error("Signup failed")}finally{u(!1),console.log(l)}},C=async()=>{try{await t.S.post("/auth/logout"),d(null),r.Ay.success("Logged out successfully"),w()}catch(e){r.Ay.error(e.message)}},A=async e=>{m(!0);try{let s=await t.S.post("/auth/login",e);d(s.data),r.Ay.success("Logged in successfully"),N()}catch(e){r.Ay.error("Failed to login")}finally{m(!1)}},_=async e=>{f(!0);try{let s=await t.S.put("/auth/update-profile",e);d(s.data),r.Ay.success("Profile updated succesfully")}catch(e){var s,l;console.log("error in update profile:",e),r.Ay.error(null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.message)}finally{f(!1)}};return(0,c.useEffect)(()=>{(null==l?void 0:l._id)?N():w()},[l,N]),(0,a.jsx)(i.Provider,{value:{authUser:l,setAuthUser:d,isSigningUp:o,setIsSigningUp:u,isLoggingIn:x,setIsLoggingIn:m,isUpdatingProfile:h,setIsUpdatingProfile:f,isCheckingAuth:v,setIsCheckingAuth:g,checkAuth:k,signup:S,logout:C,login:A,updateProfile:_,onlineUsers:j,setOnlineUsers:p,connectSocket:N,socket:b,setSocket:y},children:s})}},9766:(e,s,l)=>{"use strict";l.d(s,{D:()=>c,default:()=>r});var a=l(5155),t=l(2115);let c=(0,t.createContext)(),r=e=>{let{children:s}=e,[l,r]=(0,t.useState)(localStorage.getItem("chat-theme")||"light");return(0,a.jsx)(c.Provider,{value:{theme:l,setTheme:r},children:s})}},7595:(e,s,l)=>{"use strict";l.d(s,{S:()=>a});let a=l(2651).A.create({baseURL:"http://localhost:5001/api",withCredentials:!0})},6822:(e,s,l)=>{"use strict";l.d(s,{A:()=>a});let a=(0,l(4057).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},9609:(e,s,l)=>{"use strict";l.d(s,{A:()=>a});let a=(0,l(4057).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[150,441,517,358],()=>s(7134)),_N_E=e.O()}]);